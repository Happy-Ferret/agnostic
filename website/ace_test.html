<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>(UNIX) Guide for the Perplexed</title>

    <!-- Bootstrap -->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->


<style type="text/css" media="screen">
    #editorID {
	width: 100%;
	height: 10em;
  border: 1px solid black;
  overflow: hidden;
    }
</style>


  </head>
  <body>

<div class="container">

<div class="row">

  <div class="col-md-12">
    <h1>Ace Terminal Test</h1>

    <div id="editorID" class="col-md-12">echo $A
env
$ seq 10 | wc -l</div><!-- Ace Editor -->

</div><!-- col-md-12 -->

</div><!-- row -->

</div><!-- container -->



    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

    <!-- Ace Editor -->
    <!-- script src="./ace/ace.js"></script -->
    <script src="//cdn.jsdelivr.net/ace/1.1.3/min/ace.js"></script>

    <!-- Ace Editor Initialization -->
<script>

var editor;
var shell_prompt = "$ ";

$().ready(function(){
    editor = ace.edit("editorID");
    editor.setTheme("ace/theme/github");
    editor.getSession().setUseWrapMode(false);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setShowFoldWidgets(false);
    editor.setShowInvisibles(false);
    editor.renderer.setShowGutter(false);
    editor.renderer.setStyle("ace_one-line");
    editor.setFontSize(18);

    editor.selection.on("changeCursor",function() {
        var pos = editor.getCursorPosition();
        var maxline = editor.getSession().getDocument().getLength();
        //console.log("cursor moved", pos, " maxlines = ", maxline);
        if (pos.row != maxline-1) {
          //console.log("Forcing cursor to last line");
          editor.gotoLine(maxline,0,false);
          return;
        }
        if ( (pos.row === maxline-1) && (pos.column < shell_prompt.length)) {
          //console.log("Forcing cursor after shell prompt");
          editor.gotoLine(maxline,shell_prompt.length,false);
          return;
        }
    });

    editor.commands.bindKeys({
      "Return": function(cmdLine){
            var doc = editor.getSession().getDocument();
            var maxline = doc.getLength();
            var shell_command = doc.getLine(maxline-1);

            //Remove shell Prompt
            shell_command = shell_command.substr(shell_prompt.length);
            console.log("return: ", shell_command);

            //Execute the command

            //Add a new line prompt
            doc.insertLines(maxline,[ shell_prompt ]);
          },
      "Up": function(cmdLine){
            console.log("Up");
          },

      "Down": function(cmdLine){
            console.log("Down");
          }
      });
});

    //editor.commands.removeCommands(["find", "gotoline", "findall", "replace", "replaceall"]);
    
    //editor["$emacsModeHandler.bindKey("M-k" , "hello" );
/*    editor.commands.bindKeys({
        "Return": { command: function(cmdLine){
          var command = cmdLine.getValue();
          alert("shell command = '" + command + "'");
          cmdLine.setValue("");
        } }
        });*/

</script>

  </body>
</html>

