/*
   This file is part of UNIX Guide for the Perplexed project.
   Copyright (C) 2014 by Assaf Gordon <assafgordon@gmail.com>
   Released under GPLv3 or later.
*/
/*
This helper module provide easy loading and compiling of the Shell PEGjs parser.

This should be used only with NodeJS, until a better solution comes along.

Usage Example:

	//This will load PEGjs module, the "posix_shell.pegjs" file, and compile it.
	//The returned 'parser' object is a PEGjs parser.
	var load_shell_parser = require("utils/shell_parser_loader");
	var parser = load_shell_parser();

One optional parameter is a PEG.buildParser()-compatible options
(e.g. "allowedStartRules"), see http://pegjs.majda.cz/documentation#generating-a-parser .

Example:
	var load_shell_parser = require("utils/shell_parser_loader");
	var parser = load_shell_parser( { "allowedStartRules" : "MyRule", "cache" : true } );

*/
"use strict";

var fs = require('fs');
var path = require("path");
var peg = require("pegjs");

module.exports = load_shell_parser;

function load_shell_parser() {

	var module_file = __filename ;

	var parser_file = path.join( path.dirname(module_file),
					"..", "..", "shell_parser", "posix_shell.pegjs" );

	var parser_text = fs.readFileSync(parser_file, 'ascii');

	var parser;

	if (arguments.length==0) {
		parser = peg.buildParser(parser_text);
	} else {
		parser = peg.buildParser(parser_text,arguments[0]);
	}

	return parser;
}
