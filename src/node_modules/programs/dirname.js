/*
   This file is part of UNIX Guide for the Perplexed project.
   Copyright (C) 2014 by Assaf Gordon <assafgordon@gmail.com>
   Released under GPLv3 or later, with the following addition:

     As additional permission under GNU GPL version 3 section 7, you
     may distribute non-source (e.g., minimized or compacted) forms of
     that code without the copy of the GNU GPL normally required by
     section 4, provided you include this license notice and a URL
     through which recipients can access the Corresponding Source.

   See: https://www.gnu.org/philosophy/javascript-trap.html
*/

/*
A Naive implementation of dirname(1)

POSIX dirname(1)
http://pubs.opengroup.org/onlinepubs/009695299/utilities/dirname.html

POSIX dirname(3)
http://pubs.opengroup.org/onlinepubs/009604499/functions/dirname.html

*/
"use strict";

var ProgramBase = require('programs/program_base');
var path_utils = require('utils/path_utils');

module.exports = ProgramDirname ;

function ProgramDirname() {
	this.name = "ProgramDirname";
	this.program_name = "dirname";
}
ProgramDirname.prototype = new ProgramBase();
ProgramDirname.prototype.constructor = ProgramDirname;

ProgramDirname.prototype.internal_run=function() {
	//TODO: support "--help" and "--version"
	if (this.argv.length === 0)
		this.exit_error("missing operand");

	if (this.argv.length > 1)
		this.exit_error("extra operand: '" + this.argv[1] +"'");

	var path = this.argv[0];
	var dirname = path_utils.dirname(path);

	this.runtime.stdout.put_line(dirname);

	return 0;
}
