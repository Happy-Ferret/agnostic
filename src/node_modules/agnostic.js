/*
   This file is part of UNIX Guide for the Perplexed project.
   Copyright (C) 2014 by Assaf Gordon <assafgordon@gmail.com>
   Released under GPLv3 or later, with the following addition:

     As additional permission under GNU GPL version 3 section 7, you
     may distribute non-source (e.g., minimized or compacted) forms of
     that code without the copy of the GNU GPL normally required by
     section 4, provided you include this license notice and a URL
     through which recipients can access the Corresponding Source.

   See: https://www.gnu.org/philosophy/javascript-trap.html
*/
"use strict";

/*
*/

var ob_utils = require('utils/object_utils');
var time_utils = require('utils/time_utils');
var str_utils = require('utils/string_utils');
var path_utils = require('utils/path_utils');
var sprintf = require('utils/sprintf');

var shell_cmd_to_text = require("shell/shell_descriptor");
var shell_cmd_to_html = require("shell/shell_HTML_descriptor");
var posix_shell_parser = require('shell/posix_shell_parser');
var shell_executor  = require('shell/shell_executor2.js');
var InteractiveShell = require('shell/shell_interactive.js');

var OperatingSystem = require('os/os_state');
var FileSystem = require('os/filesystem');
var Streams = require('os/streams');
var ProcessState = require('os/process_state');
var ProgramBase = require('programs/program_base');


var Program_basename = require('programs/basename');
var Program_cat = require('programs/cat');
var Program_cut = require('programs/cut');
var Program_date = require('programs/date');
var Program_dirname = require('programs/dirname');
var Program_echo = require('programs/echo');
var Program_false = require('programs/false');
var Program_head = require('programs/head');
var Program_ls = require('programs/ls');
var Program_printf = require('programs/printf');
var Program_seq = require('programs/seq');
var Program_shell = require('programs/shell');
var Program_tac = require('programs/tac');
var Program_tail = require('programs/tail');
var Program_true = require('programs/true');
var Program_wc = require('programs/wc');

var programs = {
	"basename": Program_basename,
	"cat": Program_cat,
	"cut": Program_cut,
	"date": Program_date,
	"dirname": Program_dirname,
	"echo": Program_echo,
	"false": Program_false,
	"head": Program_head,
	"ls" : Program_ls,
	"printf": Program_printf,
	"seq": Program_seq,
	"sh": Program_shell,
	"tac": Program_tac,
	"tail": Program_tail,
	"true": Program_true,
	"wc": Program_wc,
};

var samples = require('utils/sample_data_files');

function createInteractiveShell()
{
	var sh = new InteractiveShell(posix_shell_parser);

	// Create few dummy files for the demo
	var fl = sh.fs.openfile("/passwd",true);
	fl.write( samples.passwd );

	var fl = sh.fs.openfile("/mammals.txt",true);
	fl.write( samples.mammals );

	var fl = sh.fs.openfile("/nobel.csv",true);
	fl.write( samples.nobel );

	return sh;
}

var agnostic = {
		str_utils: str_utils,
		ob_utils:  ob_utils,
		time_utils: time_utils,
		sprintf: sprintf.sprintf,

		OperatingSystem: OperatingSystem,
		FileSystem: FileSystem,
		ProcessState: ProcessState,

		programs: programs,

		createInteractiveShell : createInteractiveShell,

		shell : {
			parse_command: posix_shell_parser.parse,
			command_to_text: shell_cmd_to_text,
			command_to_html: shell_cmd_to_html,
			}
		};

module.exports = agnostic;
